{"meta":{"title":"Revincx的小破屋","subtitle":"Halleluiah☆Essaim！！！","description":null,"author":"Revincx","url":"https://blog.revincx.icu","root":"/"},"pages":[{"title":"关于","date":"2020-09-15T04:04:15.000Z","updated":"2020-09-16T01:10:39.370Z","comments":true,"path":"about/index.html","permalink":"https://blog.revincx.icu/about/index.html","excerpt":"","text":"&emsp;&emsp;普通学生狗一枚，业余喜欢写写代码，做做图，也就天天混吃混喝的样子吧(emm)。 技术&emsp;&emsp;学过Java，以前开发过一个比较简陋的安卓软件(因为没人用就删库了)，尝试用Java写过爬虫(因为不会Python)，对C语言略微了解(只是了解)。折腾过服务器(脚本复制粘贴)，会一些基本的Linux操作(比如开关机还有ping)。安卓方面喜欢刷机root啥的(日常变砖)，用过Xposed框架(包括Riru)，MIUI钉子户(真香)。网络方面会一点抓包注入啥的(然而连JSON都看不懂)，也折腾过路由器，不过现在基本不玩了。以前学过Photoshop(快忘完了)，用Illustrator做过图标(其实是现学的)，剪辑只接触过一点，基本操作也是都不记得了…. &emsp;&emsp;总结：四个字，啥都不会！ 博客&emsp;&emsp;博客是用Github Pages加上Hexo搭建的，主题是MaterialFlow，几年前的了，自己改了改勉强能用。本博客上线于2020年暑假，以后会慢慢更新文章的(新建文件夹.jpg)。 联系我酷安GithubTelegram"}],"posts":[{"title":"Easy163添加倒带支持和通知栏快捷设置","slug":"modify-easy163","date":"2020-09-20T04:52:48.000Z","updated":"2020-09-25T10:34:44.614Z","comments":true,"path":"posts/modify-easy163/","link":"","permalink":"https://blog.revincx.icu/posts/modify-easy163/","excerpt":"","text":"&emsp;&emsp;众所周知(屁)，Easy163通过拦截网易云的流量请求，从而实现一些比较NB的效果，比如无版权歌曲下载和付费歌曲下载。可是笔者更喜欢用倒带，而Easy163却不支持倒带，于是决定自己来试试适配倒带。 适配倒带&emsp;&emsp;先在Github仓库搜下网易云的包名，结果如下：吆西，AS启动！ 打开LocalVPNServices.java，定位到如下代码： 1234567891011121314151617if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123; try &#123; builder.addAllowedApplication(&quot;com.netease.cloudmusic&quot;); &#125;catch (PackageManager.NameNotFoundException e) &#123; Log.d(TAG, &quot;未检测到网易云音乐&quot;); &#125; try &#123; builder.addAllowedApplication(&quot;com.netease.cloudmusic.lite&quot;); &#125;catch (PackageManager.NameNotFoundException e) &#123; Log.d(TAG, &quot;未检测到网易云音乐极速版&quot;); &#125; &#125; 在这一段结尾加上倒带包名： 12345678try &#123; builder.addAllowedApplication(&quot;com.kuss.rewind&quot;); &#125; catch (PackageManager.NameNotFoundException e) &#123; Log.d(TAG,&quot;未检测到倒带&quot;); &#125; &emsp;&emsp;然后就是对数据包的处理了，这里本来是想着播放列表的请求也要拦截的，最好发现倒带对歌曲播放链接的请求机制和网易云不太一样，于是放弃对Playlist.java的修改，直接修改SongPlayHook.java。之间又发现一个小细节，倒带的请求头host是小写，而网易云请求头Host是大写，就因为这个小细节不知道浪费了我多少时间… 在SongPlayHook.java的请求判断加上下面的代码： 123456789if(host != null) &#123; if(method.equals(&quot;GET&quot;) &amp;&amp; host.endsWith(&quot;music.163.com&quot;) &amp;&amp; path.contains(&quot;/song/enhance/player/url&quot;)) &#123; Log.d(&quot;check rule&quot;,&quot;Rewind&quot;); isRewind = true; return true; &#125; &#125; 同时，倒带的请求没有AES加密，而网易云都有AES加密，所以在hookResponse方法内加上判断，如果是倒带的请求则不采用AES加解密，代码如下： 1234567891011121314151617super.hookResponse(response); byte[] bytes = response.getContent(); Log.d(&quot;ResponseSong:&quot;,new String(bytes)); if (!isRewind) &#123; bytes = Crypto.aesDecrypt(bytes); &#125; JSONObject jsonObject = JSONObject.parseObject(new String(bytes)); handleNoFreeSong(jsonObject); bytes = JSONObject.toJSONString(jsonObject, SerializerFeature.WriteMapNullValue).getBytes(); if(!isRewind) &#123; bytes = Crypto.aesEncrypt(bytes); &#125; Log.d(&quot;ResponseSong hooked:&quot;,new String(bytes)); response.setContent(bytes);&#125; 其中的isRewind是在BaseHook.java添加的布尔值变量。 还有一个小问题，倒带的请求结果JSON与网易云的也有区别，比如data数组里请求码套在了外面，所以还要在handleNoFreeSong方法里加上判断，代码跟上面判断差不多，就不放了。 看下效果： 添加通知栏快捷设置&emsp;&emsp;这个应该比上面的简单一点。新建类QuickTileService继承自TileService。由于Service内不能直接创建新VPN，所以要先判断是否已经创建过，代码如下： 123456789101112131415161718192021222324252627282930public void onClick() &#123; super.onClick(); Tile tile = getQsTile(); int State = tile.getState(); if(State == Tile.STATE_INACTIVE) &#123; Intent vpnIntent = VpnService.prepare(this); if (vpnIntent != null) &#123; Intent intent = new Intent(this, MainActivity.class); intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK); startActivity(intent); Toast.makeText(this,&quot;请先在软件内开启一次VPN！&quot;,Toast.LENGTH_LONG).show(); return; &#125; else &#123; Intent intent = new Intent(this, LocalVPNService.class); startService(intent); &#125; tile.setState(Tile.STATE_ACTIVE); &#125; else &#123; Intent intent = new Intent(&quot;activity&quot;); intent.putExtra(&quot;cmd&quot;, &quot;stop&quot;); LocalBroadcastManager.getInstance(this).sendBroadcast(intent); Log.d(&quot;stopVPN&quot;); &#125;&#125; 然后在AndroidManifest.xml里面添加服务，代码如下： 12345678910&lt;service android:name=&quot;.utils.QuickTileService&quot; android:label=&quot;@string/app_name&quot; android:icon=&quot;@drawable/ic_netease_cloud_music&quot; android:permission=&quot;android.permission.BIND_QUICK_SETTINGS_TILE&quot;&gt; &lt;intent-filter&gt; &lt;action android:name=&quot;android.service.quicksettings.action.QS_TILE&quot;/&gt; &lt;/intent-filter&gt; &lt;meta-data android:name=&quot;android.service.quicksettings.ACTIVE_TILE&quot; android:value=&quot;true&quot;/&gt;&lt;/service&gt; 编译运行看一下效果：效果还不错，然后就可以正式打包成APK文件了。 结尾写这篇文章加上写代码总共花了大半天时间吧，更改后的代码我会放在GitHub，并且尝试合并到原作者的项目。 下载地址：点这里安装不上的请先卸载旧版本已知Bug：部分情况下网易云会无法播放歌曲，清除缓存即可。 都看到这里了，还不去酷安给个三连支持一下？","categories":[],"tags":[{"name":"安卓","slug":"安卓","permalink":"https://blog.revincx.icu/tags/%E5%AE%89%E5%8D%93/"},{"name":"编程","slug":"编程","permalink":"https://blog.revincx.icu/tags/%E7%BC%96%E7%A8%8B/"}]},{"title":"Hello World","slug":"hello-world","date":"2020-09-16T01:14:01.570Z","updated":"2020-09-16T01:14:01.510Z","comments":true,"path":"posts/hello-world/","link":"","permalink":"https://blog.revincx.icu/posts/hello-world/","excerpt":"","text":"Q：这是什么东西？A：这是Hexo自动生成的测试文章，无视即可。 Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot; More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[],"tags":[{"name":"Hexo","slug":"Hexo","permalink":"https://blog.revincx.icu/tags/Hexo/"}]}],"categories":[],"tags":[{"name":"安卓","slug":"安卓","permalink":"https://blog.revincx.icu/tags/%E5%AE%89%E5%8D%93/"},{"name":"编程","slug":"编程","permalink":"https://blog.revincx.icu/tags/%E7%BC%96%E7%A8%8B/"},{"name":"Hexo","slug":"Hexo","permalink":"https://blog.revincx.icu/tags/Hexo/"}]}